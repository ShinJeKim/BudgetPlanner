<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.sist.repository.mappers.daily">
	<insert id="do_save" parameterType="DailyVO">
	 	INSERT INTO finance (id
		                     ,daily_code
		                     ,usage,content
		                     ,mst_ct_id
		                     ,dtl_ct_id
		                     ,reg_dt) 
		            VALUES (#{id}
		                    ,(select to_char(REG_DT,'yymmdd')||lpad(count(*)+1,3,'0')
		                    from FINANCE
		                    where id = #{id}
		                    and to_char(REG_DT,'yyyy.mm.dd') = #{reg_dt}
		                    group by to_char(REG_DT,'yymmdd'))
		                    ,#{usage}
		                    ,#{content}
		                    ,(select distinct(ct.MST_CT_ID) 
		                       from category ct
		                       where ct.mst_ct_nm = #{mst_ct_nm})
		                    ,(select ct.dtl_CT_ID 
		                       from category ct
		                       where ct.dtl_ct_nm = #{dtl_ct_nm})
		                    ,to_date(#{reg_dt},'yyyy.mm.dd'))
		                    
	</insert>               
 	
 </mapper>